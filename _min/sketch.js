/*
----------------------------------------------------------------

        trāma by p1xelfool

----------------------------------------------------------------
*/

let t=0,pg,recording=!0,pgW,pgH,runners=null,finalCol,palette=[["#FF0000","#00FF00","#0000FF"],["#FF0000","#ff5a00","#f600ff"],["#ff0000","#e2e6ec","#EB79F1"],["#CCFD7A","#e2e6ec","#EB79F1"],["#cbff00","#f4f1ee","#b084f7"],["#d7fe52","#e3ddd1","#1dec57"],["#d7fe52","#e3ddd1","#6800f6"],["#d7fe52","#e2e6ec","#00d8ff"],["#e3ddd1","#9fa597","#ee4320"],["#e2e6ec","#00d8ff","#ee4320"],["#ffffff","#bec544","#ff1500"],["#ece9db","#ad7722","#0152a3"],["#7689ff","#5dffa0","#e2e6ec"],["#d7fe52","#ed6ef7","#eb4e4d"],["#d7fe52","#1dec57","#50b4ff"],],paletteName=["RGB","Clock Sunset","Math Candy","Camera Toy","Purple Trail","Code Breeze","Vanilla Night","0 Breeze","Velvet Circuit","Pixel Noon","Soft Array","Blue Key","Cotton PI","Boot Sunrise","Light Mint"],palette1,palettePicker,colorPicker,numSystems,finalImage,tempPixels,r1=10,canvas,seeds,marginX,marginY,seedCount=0,seedIndex=0,running=!0,mod,modMult,modArray=[[4,2],[6,2],[8,2],[16,2],[2,3],[2,4],[2,8],[2,16],[3,8],[3,16]],margArray=[0,8,16,24],noiseThresh2,hasGlitch,saveGif=!1,gif,framesToSkip=1,makeGif=!1,isGifExported=!1;function setup(){canvas=createCanvas(windowWidth,windowHeight),frameRate(30),(seeds=[[int(111111*$fx.rand()),int(111111*$fx.rand()),int(111111*$fx.rand())],])[0],randomSeed(seeds[0][0]),r1=windowWidth>windowHeight?10:20,palettePicker=floor(random(0,palette.length));let e=margArray[floor(random(0,margArray.length))];marginX=e,marginY=e,noiseThresh2=.2,hasGlitch=random()>.7,numSystems=floor(random(3,5.99)),begin(seeds[0][0]),setupGif(),$fx.features({Palette:paletteName[palettePicker],Margin:marginX,Glitch:hasGlitch,Layers:numSystems}),console.log("\n\n    trāma by p1xelfool\n\n+++++++++++++++\n\n     Palette: "+paletteName[palettePicker]+"\n     Margin: "+marginX+"\n     Glitch: "+hasGlitch+"\n     Layers: "+numSystems+"\n\n+++++++++++++++")}function draw(){if(!0==running){t>1&&t%480==0&&(seedCount<2?seedCount++:seedCount=0,begin(seeds[seedIndex][int(seedCount)])),background(0),pgShow(),finalImage.loadPixels();for(let e=0;e<finalImage.width;e++)for(let i=0;i<finalImage.height;i++){let a=(e+i*finalImage.width)*4;t>478?t%2==0?(finalImage.pixels[a]=tempPixels[a],finalImage.pixels[a+1]=tempPixels[a+1],finalImage.pixels[a+2]=tempPixels[a+2],finalImage.pixels[a+3]=tempPixels[a+3]):(finalImage.pixels[a]=0,finalImage.pixels[a+1]=0,finalImage.pixels[a+2]=0,finalImage.pixels[a+3]=255):(finalImage.pixels[a]=tempPixels[a],finalImage.pixels[a+1]=tempPixels[a+1],finalImage.pixels[a+2]=tempPixels[a+2],finalImage.pixels[a+3]=tempPixels[a+3])}finalImage.updatePixels(),imageMode(CENTER),image(finalImage,windowWidth/2,windowHeight/2,windowWidth,windowHeight)}makeGif&&!isGifExported&&((frameCount-1)%framesToSkip==0||1==frameCount)&&(console.log("Added frame."),gif.addFrame(canvas.elt,{delay:30,copy:!0})),makeGif&&!isGifExported&&t>220&&(print("Exporting GIF..."),gif.render(),isGifExported=!0)}function windowResized(){resizeCanvas(windowWidth,windowHeight),r1=windowWidth>=windowHeight?10:20,begin(seeds[seedIndex][0])}function pgShow(){if(1==++t){let e;for(let i=0;i<numSystems;i++)e=0==i?palette[palettePicker][0]:1==i?palette[palettePicker][1]:2==i?palette[palettePicker][2]:palette1[i],runners.push(new ParticleSystem(random(.9,3.6),e,i,pg.width,pg.height,1))}for(let a=0;a<runners.length;a++){let n=runners[a];n.force(),n.nu(),n.update()}}function begin(e){t=0,frameCount=0,noCursor(),noiseSeed(4),strokeWeight(1.01),randomSeed(e),runners=[];let i,a;i=2560,a=2560/(innerWidth/innerHeight);let n=int(i/r1+1),l=int(a/r1+1);(pg=createGraphics(n,l)).pixelDensity(1),pg.colorMode(HSB),canvas.imageSmoothingEnabled=!1,p5.disableFriendlyErrors=!0,noSmooth();let r=int(i/r1+1),s=int(a/r1+1);finalImage=createImage(r,s),tempPixels=[],pixelDensity(1),palette1=[];for(let f=0;f<numSystems;f++)colorPicker=floor(random(0,palette[palettePicker].length)),finalCol=color(palette[palettePicker][colorPicker]),palette1[f]=finalCol}function keyTyped(){"p"===key?running=!running:"s"===key?saveCanvas(int(seedCount)+"_trama.png"):"g"===key&&(makeGif=!0,begin(seeds[seedIndex][int(seedCount)]))}function setupGif(){recordedFrames=0,(gif=new GIF({workers:2,quality:40,framerate:30,workerScript:"./gif.worker.js"})).on("finished",function(e){print("your GIF is ready ///"),rendering=!1,window.open(URL.createObjectURL(e)),setupGif(),recordedFrames=0})}